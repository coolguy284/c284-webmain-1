<!doctype html>
<html lang = 'en'>
  <head>
    <meta charset = 'utf-8'>
    
    <title>coolguy284.com: Service Worker</title>
    
    <meta name = 'viewport' content = 'width=device-width, initial-scale=1.0'>
    <meta name = 'description' content = 'The service worker for this website. Can be installed to allow offline access to the page.'>
    <meta name = 'keywords' content = 'service-worker'>
    <meta name = 'author' content = 'coolguy284'>
    
    <link rel = 'canonical' href = 'https://coolguy284.com/misc/service_worker.html'>
    
    <meta name = 'og:title' content = 'coolguy284.com: Service Worker'>
    <meta name = 'og:description' content = 'The service worker for this website. Can be installed to allow offline access to the page.'>
    <meta name = 'og:type' content = 'website'>
    <meta name = 'og:url' content = 'https://coolguy284.com/misc/service_worker.html'>
    
    <link rel = 'stylesheet' href = '/libs/extern/bootstrap_5.0.0.min.css'>
    <style>
      body { background-color: #e8e8ff; }
      
      td { padding-right: 1rem; }
    </style>
  </head>
  
  <body>
    <div class = 'container-lg'>
      <noscript>
        <div class = 'alert alert-warning' role = 'alert' style = 'padding: 0.5rem 2rem 0.5rem;'>
          Note: This uses JavaScript to activate, deactivate, and monitor the service worker (JavaScript is disabled).
        </div>
      </noscript>
      <br>
      <h1>Service Worker</h1>
      <br>
      <table>
        <tbody>
          <tr>
            <td>Status:</td>
            <td id = 'service_worker_status'>-</td>
          </tr>
        </tbody>
      </table>
      <br>
      <button id = 'service_worker_btn_install' class = 'btn btn-primary disabled' onclick = 'installServiceWorker();'>Install / Update</button>
    </div>
    
    <script>
      let SERVICE_WORKER_URL = '/service_worker.js';
      
      // https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers
      
      function updateRegistrationStatus(registration) {
        if (!registration) {
          service_worker_status.textContent = 'Service worker not installed';
        } else {
          if (registration.installing) {
            service_worker_status.textContent = 'Service worker installing';
          } else if (registration.waiting) {
            service_worker_status.textContent = 'Service worker installed';
          } else if (registration.active) {
            service_worker_status.textContent = 'Service worker active';
          }
        }
      }
      
      async function installServiceWorker() {
        service_worker_btn_install.classList.add('disabled');
        
        try {
          return;
          let registration = await navigator.serviceWorker.register(SERVICE_WORKER_URL);
          
          updateRegistrationStatus(registration);
        } catch {
          alert('Service worker registration failure');
        } finally {
          service_worker_btn_install.classList.remove('disabled');
        }
      }
      
      if (!('serviceWorker' in navigator)) {
        service_worker_status.textContent = 'service workers unavailable';
      } else {
        service_worker_btn_install.classList.remove('disabled');
        (async () => {
          let registration = await navigator.serviceWorker.getRegistration(SERVICE_WORKER_URL);
          
          updateRegistrationStatus(registration);
        })();
      }
    </script>
  </body>
</html>
